<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Upgrades Hub</title>
  <style>
    :root{
      --bg: #f6f8f7;
      --panel: #ffffff;
      --mint-100: #e9f6f0;
      --mint-200: #d8f0e6;
      --mint-300: #bfe6d7;
      --accent: #2f8f6b;
      --accent-dark:#236b50;
      --text: #1f2937;
      --muted: #6b7280;
      --radius-lg: 14px;
      --radius-md: 10px;
      --shadow-sm: 0 2px 10px rgba(0,0,0,0.06);
      --shadow-md: 0 10px 30px rgba(0,0,0,0.08);
      --sidebar-w: 220px;
      --border-soft: rgba(0,0,0,0.06);
      --row-hover: #f4fbf7;
      --row-odd: #fcfdfc;
      --thead-bg: #fbfffd;
    }

    html[data-theme="dark"]{
      --bg: #0f1413;
      --panel: #121a18;
      --mint-100: #0f2420;
      --mint-200: #123029;
      --mint-300: #154037;
      --accent: #4bd6a2;
      --accent-dark: #c9ffea;
      --text: #e6f0ee;
      --muted: #9aa7a3;
      --shadow-sm: 0 2px 10px rgba(0,0,0,0.35);
      --shadow-md: 0 10px 30px rgba(0,0,0,0.45);
      --border-soft: rgba(255,255,255,0.06);
      --row-hover: #14261f;
      --row-odd: #101a17;
      --thead-bg: #0f1f1a;
    }

    *{box-sizing:border-box;}

    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color: var(--text);
      background:
        radial-gradient(1200px 600px at 80% -10%, var(--mint-100), transparent 60%),
        radial-gradient(900px 500px at -10% 30%, var(--mint-200), transparent 55%),
        var(--bg);
      min-height:100vh;
    }

    .route{
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .frame{
      display:grid;
      grid-template-columns: var(--sidebar-w) minmax(0, 1fr);
      min-height: 100vh;
    }

    .sidebar{
      background: var(--panel);
      border-right: 1px solid var(--border-soft);
      box-shadow: 6px 0 24px rgba(0,0,0,0.05);
      padding: 14px 10px 18px;
      position: sticky;
      top: 0;
      height: 100vh;
      overflow: auto;
      border-radius: 0 var(--radius-lg) var(--radius-lg) 0;
    }

    .sidebar-title{
      display:flex;
      align-items:center;
      gap: 8px;
      padding: 10px 12px 6px;
      font-size: 11px;
      color: var(--muted);
      font-weight: 700;
      letter-spacing: 0.12em;
      text-transform: uppercase;
    }

    .nav{
      display:flex;
      flex-direction: column;
      gap: 6px;
      padding: 6px;
    }

    .nav-divider{
      height: 1px;
      background: var(--border-soft);
      margin: 8px 8px 6px;
    }

    .nav-btn{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      padding: 10px 10px;
      border-radius: var(--radius-md);
      cursor: pointer;
      font-size: 13px;
      font-weight: 650;
      color: var(--muted);
      transition: background .15s, color .15s, box-shadow .15s, transform .08s;
      user-select:none;
    }
    .nav-btn:hover{
      background: rgba(47,143,107,0.08);
      color: var(--text);
    }
    .nav-btn:active{ transform: translateY(1px); }

    .nav-mini{
      font-size: 10px;
      color: rgba(0,0,0,0.35);
      font-weight: 700;
      padding: 2px 6px;
      border-radius: 999px;
      background: rgba(0,0,0,0.04);
      white-space: nowrap;
    }
    html[data-theme="dark"] .nav-mini{
      color: rgba(255,255,255,0.65);
      background: rgba(255,255,255,0.06);
    }

    #r-upgrades:checked ~ .frame .sidebar label[for="r-upgrades"],
    #r-ore:checked ~ .frame .sidebar label[for="r-ore"],
    #r-pickaxe:checked ~ .frame .sidebar label[for="r-pickaxe"],
    #r-elvl:checked ~ .frame .sidebar label[for="r-elvl"],
    #r-cards:checked ~ .frame .sidebar label[for="r-cards"],
    #r-timewarp:checked ~ .frame .sidebar label[for="r-timewarp"],
    #r-settings:checked ~ .frame .sidebar label[for="r-settings"]{
      background: linear-gradient(180deg, var(--mint-200), var(--mint-100));
      color: var(--accent-dark);
      box-shadow: inset 0 0 0 1px rgba(47,143,107,0.18);
    }

    .content{
      padding: 26px 22px 60px;
    }

    .main{
      background: var(--panel);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-md);
      border: 1px solid var(--border-soft);
      overflow: hidden;
    }

    .main-inner{
      padding: 18px 18px 24px;
    }

    .page{ display:none; }

    #r-upgrades:checked ~ .frame #page-upgrades,
    #r-ore:checked ~ .frame #page-ore,
    #r-pickaxe:checked ~ .frame #page-pickaxe,
    #r-elvl:checked ~ .frame #page-elvl,
    #r-cards:checked ~ .frame #page-cards,
    #r-timewarp:checked ~ .frame #page-timewarp,
    #r-settings:checked ~ .frame #page-settings{
      display:block;
    }

    .section-head{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 12px;
      margin-bottom: 14px;
    }
    .section-title{
      font-size: 22px;
      font-weight: 780;
      letter-spacing: 0.01em;
    }
    .section-sub{
      font-size: 12px;
      color: var(--muted);
      margin-top: 2px;
    }

    .pill{
      display:inline-flex;
      align-items:center;
      padding: 3px 8px;
      border-radius: 999px;
      font-size: 10px;
      font-weight: 700;
      letter-spacing: 0.05em;
      text-transform: uppercase;
      background: rgba(47,143,107,0.10);
      color: var(--accent-dark);
      border: 1px solid rgba(47,143,107,0.18);
      white-space: nowrap;
    }

    .muted{ color: var(--muted); }

    .dest-route{
      position: absolute;
      opacity: 0;
      pointer-events: none;
    }

    .dest-bar{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      padding: 10px 0 14px;
      border-bottom: 1px dashed var(--border-soft);
      margin-bottom: 16px;
    }

    .dest-pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 8px 12px;
      border-radius: 999px;
      font-size: 11px;
      font-weight: 750;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: var(--accent-dark);
      background: linear-gradient(180deg, var(--mint-200), var(--mint-100));
      border: 1px solid rgba(47,143,107,0.18);
      cursor: pointer;
      transition: transform .08s, box-shadow .15s, filter .15s, opacity .15s;
      user-select:none;
    }
    .dest-pill:hover{ filter: saturate(1.05); box-shadow: var(--shadow-sm); }
    .dest-pill:active{ transform: translateY(1px); }

    .dest-pill .mini{
      font-size: 9px;
      background: rgba(0,0,0,0.06);
      color: rgba(0,0,0,0.55);
      padding: 2px 6px;
      border-radius: 999px;
      font-weight: 800;
      letter-spacing: 0.04em;
    }
    html[data-theme="dark"] .dest-pill .mini{
      background: rgba(255,255,255,0.08);
      color: rgba(255,255,255,0.75);
    }

    .dest-bar .dest-pill{ opacity: .55; }

    #d-point:checked ~ .dest-bar label[for="d-point"],
    #d-blackhole:checked ~ .dest-bar label[for="d-blackhole"],
    #d-mining:checked ~ .dest-bar label[for="d-mining"],
    #d-transcend:checked ~ .dest-bar label[for="d-transcend"],
    #d-star:checked ~ .dest-bar label[for="d-star"],
    #d-sacrifice:checked ~ .dest-bar label[for="d-sacrifice"]{
      opacity: 1;
      box-shadow: inset 0 0 0 1px rgba(47,143,107,0.22), var(--shadow-sm);
      filter: saturate(1.15);
    }

    .dest-panel{ display:none; }

    #d-point:checked ~ .dest-content #panel-point,
    #d-blackhole:checked ~ .dest-content #panel-blackhole,
    #d-mining:checked ~ .dest-content #panel-mining,
    #d-transcend:checked ~ .dest-content #panel-transcend,
    #d-star:checked ~ .dest-content #panel-star,
    #d-sacrifice:checked ~ .dest-content #panel-sacrifice{
      display:block;
    }

    .table-wrap{
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-md);
      overflow: auto;
      background: transparent;
    }

    table{
      width: 100%;
      border-collapse: collapse;
      min-width: 640px;
    }

    thead th{
      position: sticky;
      top: 0;
      background: var(--thead-bg);
      text-align:left;
      font-size: 11px;
      color: var(--accent-dark);
      letter-spacing: 0.08em;
      text-transform: uppercase;
      padding: 12px 12px;
      border-bottom: 1px solid var(--border-soft);
    }

    tbody td{
      padding: 11px 12px;
      font-size: 13px;
      border-bottom: 1px solid var(--border-soft);
      color: var(--text);
      vertical-align: top;
    }

    tbody tr:nth-child(odd){ background: var(--row-odd); }
    tbody tr:hover{ background: var(--row-hover); }

    .form-grid{
      display:grid;
      grid-template-columns: repeat(2, minmax(0,1fr));
      gap: 12px;
    }

    .field{
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-md);
      padding: 12px 12px 10px;
      background: linear-gradient(180deg, rgba(255,255,255,0.6), rgba(255,255,255,0.2));
    }
    html[data-theme="dark"] .field{
      background: linear-gradient(180deg, rgba(255,255,255,0.03), rgba(255,255,255,0.01));
    }

    .field label{
      display:block;
      font-size: 11px;
      font-weight: 700;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--muted);
      margin-bottom: 8px;
    }

    .field input[type="text"],
    .field select{
      width: 100%;
      border: 1px solid rgba(0,0,0,0.1);
      border-radius: 10px;
      padding: 9px 10px;
      font-size: 13px;
      outline: none;
      background: var(--panel);
      color: var(--text);
      transition: border-color .15s, box-shadow .15s;
    }
    html[data-theme="dark"] .field input,
    html[data-theme="dark"] .field select{
      border-color: rgba(255,255,255,0.12);
    }

    .field input:focus,
    .field select:focus{
      border-color: rgba(47,143,107,0.5);
      box-shadow: 0 0 0 4px rgba(47,143,107,0.12);
    }

    /* --- Pickaxe chooser UI --- */
    .pickaxe-chooser{
      border: 1px solid var(--border-soft);
      border-radius: var(--radius-md);
      padding: 14px;
      background:
        linear-gradient(180deg, rgba(47,143,107,0.05), transparent 40%);
    }

    .pickaxe-grid{
      display:grid;
      grid-template-columns: repeat(3, minmax(0,1fr));
      gap: 12px;
    }

    .pickaxe-card{
      border: 1px solid var(--border-soft);
      border-radius: 12px;
      background: var(--panel);
      padding: 10px;
      cursor: pointer;
      transition: box-shadow .15s, transform .08s, border-color .15s, filter .15s;
      position: relative;
      outline: none;
    }
    .pickaxe-card:hover{
      box-shadow: var(--shadow-sm);
      filter: saturate(1.05);
    }
    .pickaxe-card:active{ transform: translateY(1px); }
    .pickaxe-card:focus-visible{
      box-shadow: 0 0 0 4px rgba(47,143,107,0.14);
      border-color: rgba(47,143,107,0.45);
    }

    .pickaxe-card.selected{
      border-color: rgba(47,143,107,0.55);
      box-shadow:
        0 0 0 1px rgba(47,143,107,0.12),
        var(--shadow-sm);
      background:
        linear-gradient(180deg, var(--mint-200), transparent 48%),
        var(--panel);
    }

    .pickaxe-badge{
      position: absolute;
      top: 8px;
      right: 8px;
      font-size: 9px;
      font-weight: 800;
      letter-spacing: .08em;
      text-transform: uppercase;
      padding: 3px 6px;
      border-radius: 999px;
      background: rgba(47,143,107,0.14);
      border: 1px solid rgba(47,143,107,0.25);
      color: var(--accent-dark);
      display: none;
    }
    .pickaxe-card.selected .pickaxe-badge{
      display: inline-flex;
    }

    .pickaxe-img{
      width: 100%;
      aspect-ratio: 1.2 / 1;
      object-fit: contain;
      border-radius: 10px;
      background:
        linear-gradient(180deg, rgba(0,0,0,0.02), transparent 60%);
      border: 1px dashed var(--border-soft);
    }
    html[data-theme="dark"] .pickaxe-img{
      background:
        linear-gradient(180deg, rgba(255,255,255,0.03), transparent 60%);
    }

    .pickaxe-name{
      margin-top: 8px;
      font-size: 12px;
      font-weight: 700;
      color: var(--text);
    }

    .pickaxe-sub{
      font-size: 11px;
      color: var(--muted);
      margin-top: 2px;
      min-height: 14px;
    }

    @media (max-width: 980px){
      .pickaxe-grid{ grid-template-columns: repeat(2, minmax(0,1fr)); }
    }
    @media (max-width: 560px){
      .pickaxe-grid{ grid-template-columns: 1fr; }
    }

    /* --- Settings + misc --- */
    .toggle{
      display:flex;
      align-items:center;
      gap: 10px;
      font-size: 12px;
      color: var(--muted);
    }

    .toggle input{
      width: 18px; height: 18px;
      accent-color: var(--accent);
    }

    .radio-row{
      display:flex;
      flex-wrap: wrap;
      gap: 10px 14px;
    }

    .radio-pill{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid var(--border-soft);
      background: rgba(0,0,0,0.02);
      font-size: 11px;
      font-weight: 650;
      color: var(--muted);
      cursor: pointer;
      user-select:none;
    }
    html[data-theme="dark"] .radio-pill{
      background: rgba(255,255,255,0.04);
    }
    .radio-pill input{ accent-color: var(--accent); }

    .demo-box{
      border: 1px dashed var(--border-soft);
      border-radius: var(--radius-md);
      padding: 10px 10px 8px;
      margin-top: 8px;
      background: rgba(0,0,0,0.02);
    }
    html[data-theme="dark"] .demo-box{
      background: rgba(255,255,255,0.03);
    }

    .demo-row{
      display:flex;
      justify-content: space-between;
      gap: 10px;
      padding: 6px 4px;
      font-size: 12px;
      border-bottom: 1px solid var(--border-soft);
    }
    .demo-row:last-child{ border-bottom: none; }

    .demo-k{
      color: var(--muted);
      font-weight: 600;
    }

    .btn-row{
      display:flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
    }

    .btn{
      border: 1px solid rgba(47,143,107,0.2);
      background: linear-gradient(180deg, var(--mint-200), var(--mint-100));
      color: var(--accent-dark);
      font-size: 12px;
      font-weight: 750;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      padding: 9px 12px;
      border-radius: 10px;
      cursor: pointer;
      user-select: none;
      transition: transform .08s, box-shadow .15s, filter .15s;
    }
    .btn:hover{ box-shadow: var(--shadow-sm); filter: saturate(1.05); }
    .btn:active{ transform: translateY(1px); }

    .btn.secondary{
      background: var(--panel);
      border-color: rgba(0,0,0,0.1);
      color: var(--muted);
    }
    html[data-theme="dark"] .btn.secondary{
      border-color: rgba(255,255,255,0.12);
    }

    /* --- NEW: pickaxe steps --- */
    .pickaxe-step{
      margin-bottom: 14px;
    }
    .hidden{
      display: none !important;
    }

    @media (max-width: 900px){
      :root{ --sidebar-w: 190px; }
      table{ min-width: 560px; }
    }

    @media (max-width: 820px){
      .form-grid{ grid-template-columns: 1fr; }
    }

    @media (max-width: 720px){
      .frame{ grid-template-columns: 1fr; }
      .sidebar{
        position: static;
        height: auto;
        border-radius: 0 0 var(--radius-lg) var(--radius-lg);
        box-shadow: var(--shadow-sm);
        border-right: none;
        border-bottom: 1px solid var(--border-soft);
      }
      .nav{ flex-direction: row; flex-wrap: wrap; }
      .nav-btn{ flex: 1 1 auto; justify-content:center; }
      .content{ padding: 18px 14px 50px; }
      table{ min-width: 520px; }
    }
  </style>
</head>

<body>
  <input class="route" type="radio" name="route" id="r-upgrades" checked />
  <input class="route" type="radio" name="route" id="r-ore" />
  <input class="route" type="radio" name="route" id="r-pickaxe" />
  <input class="route" type="radio" name="route" id="r-elvl" />
  <input class="route" type="radio" name="route" id="r-cards" />
  <input class="route" type="radio" name="route" id="r-timewarp" />
  <input class="route" type="radio" name="route" id="r-settings" />

  <div class="frame">

    <aside class="sidebar" aria-label="Sections">
      <div class="sidebar-title">Core</div>
      <nav class="nav">
        <label class="nav-btn" for="r-upgrades"><span>Upgrades</span><span class="nav-mini">U</span></label>
        <label class="nav-btn" for="r-ore"><span>Ore Mastery</span><span class="nav-mini">OM</span></label>
        <label class="nav-btn" for="r-pickaxe"><span>Pickaxe</span><span class="nav-mini">P</span></label>
        <label class="nav-btn" for="r-elvl"><span>ELvl</span><span class="nav-mini">E</span></label>
        <label class="nav-btn" for="r-cards"><span>Cards</span><span class="nav-mini">C</span></label>

        <div class="nav-divider"></div>

        <div class="sidebar-title" style="padding-top:4px;">Meta</div>
        <label class="nav-btn" for="r-timewarp"><span>Time Warp</span><span class="nav-mini">TW</span></label>
        <label class="nav-btn" for="r-settings"><span>Settings</span><span class="nav-mini">⚙</span></label>
      </nav>
    </aside>

    <div class="content">
      <main class="main">
        <div class="main-inner">

          <!-- UPGRADES (no prompts yet) -->
          <section class="page" id="page-upgrades">
            <input class="dest-route" type="radio" name="dest" id="d-point" checked />
            <input class="dest-route" type="radio" name="dest" id="d-blackhole" />
            <input class="dest-route" type="radio" name="dest" id="d-mining" />
            <input class="dest-route" type="radio" name="dest" id="d-transcend" />
            <input class="dest-route" type="radio" name="dest" id="d-star" />
            <input class="dest-route" type="radio" name="dest" id="d-sacrifice" />

            <div class="section-head">
              <div>
                <div class="section-title">Upgrades</div>
                <div class="section-sub">Pick a destination to view its upgrade table.</div>
              </div>
              <span class="pill">Destinations</span>
            </div>

            <div class="dest-bar" role="tablist" aria-label="Destinations">
              <label class="dest-pill" for="d-point" role="tab"><span>Point Basement</span><span class="mini">PB</span></label>
              <label class="dest-pill" for="d-blackhole" role="tab"><span>Blackhole Basement</span><span class="mini">BB</span></label>
              <label class="dest-pill" for="d-mining" role="tab"><span>Mining Baseplate</span><span class="mini">MB</span></label>
              <label class="dest-pill" for="d-transcend" role="tab"><span>Transcend Baseplate</span><span class="mini">TB</span></label>
              <label class="dest-pill" for="d-star" role="tab"><span>Star Tree</span><span class="mini">ST</span></label>
              <label class="dest-pill" for="d-sacrifice" role="tab"><span>Sacrifice Baseplate</span><span class="mini">SB</span></label>
            </div>

            <div class="dest-content">

              <div class="dest-panel" id="panel-point">
                <div class="section-head">
                  <div>
                    <div class="section-title" style="font-size:18px;">Point Basement Upgrades</div>
                    <div class="section-sub">Replace these rows with your real Point Basement data.</div>
                  </div>
                  <span class="pill">PB</span>
                </div>
                <div class="table-wrap">
                  <table>
                    <thead>
                      <tr><th>Upgrade</th><th>Type</th><th>Cost</th><th>Requirement</th><th>Effect</th><th class="muted">Notes</th></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Point Amplifier I</td>
                        <td><span class="pill">Economy</span></td>
                        <td><span data-num="150"></span> Ore</td>
                        <td>Base Level 1</td>
                        <td>+<span data-num="5"></span>% point gain</td>
                        <td class="muted">Early scaling</td>
                      </tr>
                      <tr>
                        <td>Basement Shield</td>
                        <td><span class="pill">Defense</span></td>
                        <td><span data-num="400"></span> Ore</td>
                        <td>Complete 1 quest</td>
                        <td>+<span data-num="10"></span>% structure HP</td>
                        <td class="muted">Example row</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="dest-panel" id="panel-blackhole">
                <div class="section-head">
                  <div>
                    <div class="section-title" style="font-size:18px;">Blackhole Basement Upgrades</div>
                    <div class="section-sub">Replace these rows with your real Blackhole data.</div>
                  </div>
                  <span class="pill">BB</span>
                </div>
                <div class="table-wrap">
                  <table>
                    <thead>
                      <tr><th>Upgrade</th><th>Type</th><th>Cost</th><th>Requirement</th><th>Effect</th><th class="muted">Notes</th></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Gravity Well I</td>
                        <td><span class="pill">Utility</span></td>
                        <td><span data-num="1"></span> Void Core</td>
                        <td>ELvl <span data-num="5"></span></td>
                        <td>Unlock pull mechanic</td>
                        <td class="muted">Theme core</td>
                      </tr>
                      <tr>
                        <td>Singularity Forge</td>
                        <td><span class="pill">Economy</span></td>
                        <td><span data-num="900"></span> Ore</td>
                        <td>Pickaxe Mk.2</td>
                        <td>+<span data-num="1.5"></span> Ore/sec passive</td>
                        <td class="muted">Example row</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="dest-panel" id="panel-mining">
                <div class="section-head">
                  <div>
                    <div class="section-title" style="font-size:18px;">Mining Baseplate Upgrades</div>
                    <div class="section-sub">Replace these rows with your real Mining data.</div>
                  </div>
                  <span class="pill">MB</span>
                </div>
                <div class="table-wrap">
                  <table>
                    <thead>
                      <tr><th>Upgrade</th><th>Type</th><th>Cost</th><th>Requirement</th><th>Effect</th><th class="muted">Notes</th></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Auto Miner Array</td>
                        <td><span class="pill">Economy</span></td>
                        <td><span data-num="1200"></span> Ore</td>
                        <td>Base Level 2</td>
                        <td>+<span data-num="2"></span> Ore/sec passive</td>
                        <td class="muted">Core mining loop</td>
                      </tr>
                      <tr>
                        <td>Vein Scanner</td>
                        <td><span class="pill">Utility</span></td>
                        <td><span data-num="3"></span> Scanner Parts</td>
                        <td>Ore Mastery I</td>
                        <td>+<span data-num="10"></span>% rare find chance</td>
                        <td class="muted">Example row</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="dest-panel" id="panel-transcend">
                <div class="section-head">
                  <div>
                    <div class="section-title" style="font-size:18px;">Transcend Baseplate Upgrades</div>
                    <div class="section-sub">Replace these rows with your real Transcend data.</div>
                  </div>
                  <span class="pill">TB</span>
                </div>
                <div class="table-wrap">
                  <table>
                    <thead>
                      <tr><th>Upgrade</th><th>Type</th><th>Cost</th><th>Requirement</th><th>Effect</th><th class="muted">Notes</th></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Ascension Catalysts</td>
                        <td><span class="pill">Progression</span></td>
                        <td><span data-num="1"></span> Transcend Sigil</td>
                        <td>ELvl <span data-num="25"></span></td>
                        <td>Unlock prestige track</td>
                        <td class="muted">Late game gate</td>
                      </tr>
                      <tr>
                        <td>Echo Multipliers</td>
                        <td><span class="pill">Economy</span></td>
                        <td><span data-num="2"></span> Sigils</td>
                        <td>Complete 5 trials</td>
                        <td>+<span data-num="15"></span>% all gains</td>
                        <td class="muted">Example row</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="dest-panel" id="panel-star">
                <div class="section-head">
                  <div>
                    <div class="section-title" style="font-size:18px;">Star Tree Upgrades</div>
                    <div class="section-sub">Replace these rows with your real Star Tree data.</div>
                  </div>
                  <span class="pill">ST</span>
                </div>
                <div class="table-wrap">
                  <table>
                    <thead>
                      <tr><th>Upgrade</th><th>Type</th><th>Cost</th><th>Requirement</th><th>Effect</th><th class="muted">Notes</th></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Starlight Sap</td>
                        <td><span class="pill">Utility</span></td>
                        <td><span data-num="50"></span> Star Leaves</td>
                        <td>Ore Mastery II</td>
                        <td>Unlock star crafting</td>
                        <td class="muted">Theme unlock</td>
                      </tr>
                      <tr>
                        <td>Constellation Boost</td>
                        <td><span class="pill">Economy</span></td>
                        <td><span data-num="200"></span> Leaves</td>
                        <td>Complete 3 events</td>
                        <td>+<span data-num="8"></span>% global gain</td>
                        <td class="muted">Example row</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

              <div class="dest-panel" id="panel-sacrifice">
                <div class="section-head">
                  <div>
                    <div class="section-title" style="font-size:18px;">Sacrifice Baseplate Upgrades</div>
                    <div class="section-sub">Replace these rows with your real Sacrifice data.</div>
                  </div>
                  <span class="pill">SB</span>
                </div>
                <div class="table-wrap">
                  <table>
                    <thead>
                      <tr><th>Upgrade</th><th>Type</th><th>Cost</th><th>Requirement</th><th>Effect</th><th class="muted">Notes</th></tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>Offering Engine</td>
                        <td><span class="pill">Progression</span></td>
                        <td><span data-num="1"></span> Relic</td>
                        <td>ELvl <span data-num="15"></span></td>
                        <td>Convert losses into buffs</td>
                        <td class="muted">High-risk system</td>
                      </tr>
                      <tr>
                        <td>Bloodline Pact</td>
                        <td><span class="pill">Defense</span></td>
                        <td><span data-num="3"></span> Relics</td>
                        <td>Complete 2 sacrifices</td>
                        <td>+<span data-num="12"></span>% damage resist</td>
                        <td class="muted">Example row</td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>

            </div>
          </section>

          <!-- ORE MASTERY (no prompts yet) -->
          <section class="page" id="page-ore">
            <div class="section-head">
              <div>
                <div class="section-title">Ore Mastery</div>
                <div class="section-sub">Track mastery tiers, bonuses, and unlock paths.</div>
              </div>
              <span class="pill">Ore Mastery</span>
            </div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Ore Type</th><th>Tier</th><th>XP Required</th><th>Bonus</th><th>Unlocks</th><th class="muted">Notes</th></tr></thead>
                <tbody>
                  <tr><td>Iron</td><td><span class="pill">I</span></td><td><span data-num="0"></span></td><td>+<span data-num="0"></span>%</td><td>Base mining</td><td class="muted">Starter</td></tr>
                  <tr><td>Gold</td><td><span class="pill">II</span></td><td><span data-num="500"></span></td><td>+<span data-num="5"></span>% yield</td><td>Improved smelt</td><td class="muted">Example row</td></tr>
                  <tr><td>Mythic Ore</td><td><span class="pill">V</span></td><td><span data-num="10000"></span></td><td>+<span data-num="25"></span>% yield</td><td>Special crafts</td><td class="muted">Endgame</td></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- PICKAXE (Step 1 images -> Step 2 dropdown) -->
          <section class="page" id="page-pickaxe">
            <div class="section-head">
              <div>
                <div class="section-title">Pickaxe</div>
                <div class="section-sub">Pick your pickaxe, then continue to the next prompt.</div>
              </div>
              <span class="pill">Pickaxe</span>
            </div>

            <!-- STEP 1: IMAGE CHOOSER -->
            <div id="pickaxeStepChoose" class="pickaxe-step">
              <div class="pickaxe-chooser">
                <div class="section-head" style="margin-bottom:10px;">
                  <div>
                    <div class="section-title" style="font-size:16px;">Choose your pickaxe</div>
                    <div class="section-sub">Click an image to select it.</div>
                  </div>
                  <span class="pill">Step 1</span>
                </div>

                <div id="pickaxeChooserGrid" class="pickaxe-grid" role="listbox" aria-label="Pickaxe choices"></div>
              </div>
            </div>

            <!-- STEP 2: DROPDOWN PROMPT -->
            <div id="pickaxeStepDropdown" class="pickaxe-step hidden">
              <div class="section-head">
                <div>
                  <div class="section-title" style="font-size:18px;">Pickaxe Prompt</div>
                  <div class="section-sub">Your pickaxe is locked in. Choose the next option.</div>
                </div>
                <span class="pill">Step 2</span>
              </div>

              <div class="form-grid">
                <div class="field">
                  <label>Pickaxe Selected</label>
                  <input type="text" id="pickaxeSelectedName" readonly />
                  <div class="section-sub" style="margin-top:8px;">Auto-filled from Step 1.</div>
                </div>

                <div class="field">
                  <label>Pickaxe Mode</label>
                  <select id="pickaxeDropdown1">
                    <option value="">Select an option</option>
                    <option value="A">Option A</option>
                    <option value="B">Option B</option>
                    <option value="C">Option C</option>
                    <option value="D">Option D</option>
                    <option value="E">Option E</option>
                  </select>
                  <div class="section-sub" style="margin-top:8px;">Rename these to your real choices.</div>
                </div>
              </div>

              <div class="btn-row">
                <button class="btn secondary" type="button" id="pickaxeChangeBtn">Change Pickaxe</button>
              </div>
            </div>

            <div class="table-wrap">
              <table>
                <thead><tr><th>Model</th><th>Tier</th><th>Power</th><th>Speed</th><th>Special</th><th class="muted">Notes</th></tr></thead>
                <tbody>
                  <tr><td>Starter Pick</td><td><span class="pill">Mk.1</span></td><td><span data-num="10"></span></td><td><span data-num="1"></span>x</td><td>None</td><td class="muted">Baseline stats</td></tr>
                  <tr><td>Core Splitter</td><td><span class="pill">Mk.3</span></td><td><span data-num="35"></span></td><td><span data-num="1.4"></span>x</td><td>+<span data-num="5"></span>% crit</td><td class="muted">Example</td></tr>
                  <tr><td>Celestial Drill</td><td><span class="pill">Mk.6</span></td><td><span data-num="120"></span></td><td><span data-num="2.2"></span>x</td><td>AOE break</td><td class="muted">Late game</td></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- ELVL (1 text prompt) -->
          <section class="page" id="page-elvl">
            <div class="section-head">
              <div>
                <div class="section-title">ELvl</div>
                <div class="section-sub">Experience levels, rewards, and milestones.</div>
              </div>
              <span class="pill">ELvl</span>
            </div>

            <div class="form-grid" style="margin-bottom: 14px;">
              <div class="field">
                <label>ELvl Prompt</label>
                <input type="text" id="elvlPrompt1" placeholder="Type here..." />
              </div>
            </div>

            <div class="table-wrap">
              <table>
                <thead><tr><th>Level</th><th>XP Needed</th><th>Reward</th><th>Unlock</th><th>Multiplier</th><th class="muted">Notes</th></tr></thead>
                <tbody>
                  <tr><td><span data-num="1"></span></td><td><span data-num="0"></span></td><td>Starter pack</td><td>Basic destinations</td><td><span data-num="1"></span>.00x</td><td class="muted">Example row</td></tr>
                  <tr><td><span data-num="10"></span></td><td><span data-num="2000"></span></td><td>+1 card slot</td><td>Ore Mastery II</td><td><span data-num="1.05"></span>x</td><td class="muted">Mid milestone</td></tr>
                  <tr><td><span data-num="50"></span></td><td><span data-num="50000"></span></td><td>Legend token</td><td>Transcend systems</td><td><span data-num="1.2"></span>x</td><td class="muted">End milestone</td></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- CARDS (no prompts yet) -->
          <section class="page" id="page-cards">
            <div class="section-head">
              <div>
                <div class="section-title">Cards Library</div>
                <div class="section-sub">A different table layout for cards.</div>
              </div>
              <span class="pill">Cards</span>
            </div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Card Name</th><th>Rarity</th><th>Energy</th><th>Ability</th><th>Synergy</th><th class="muted">Notes</th></tr></thead>
                <tbody>
                  <tr><td>Gravity Seed</td><td><span class="pill">Rare</span></td><td><span data-num="2"></span></td><td>Pull enemies 1 tile</td><td>Blackhole set</td><td class="muted">Great for combos</td></tr>
                  <tr><td>Ore Bloom</td><td><span class="pill">Common</span></td><td><span data-num="1"></span></td><td>Gain +<span data-num="100"></span> Ore</td><td>Mining builds</td><td class="muted">Fast economy spike</td></tr>
                  <tr><td>Transcend Echo</td><td><span class="pill">Epic</span></td><td><span data-num="4"></span></td><td>Duplicate last effect</td><td>Combo decks</td><td class="muted">High skill ceiling</td></tr>
                </tbody>
              </table>
            </div>
          </section>

          <!-- TIME WARP -->
          <section class="page" id="page-timewarp">
            <div class="section-head">
              <div>
                <div class="section-title">Time Warp</div>
                <div class="section-sub">A meta system hub for boosts, cooldowns, and rewind mechanics.</div>
              </div>
              <span class="pill">Meta</span>
            </div>
            <div class="table-wrap">
              <table>
                <thead><tr><th>Warp Name</th><th>Type</th><th>Cost</th><th>Duration</th><th>Effect</th><th class="muted">Cooldown</th></tr></thead>
                <tbody>
                  <tr><td>Minute Skip</td><td><span class="pill">Boost</span></td><td><span data-num="1"></span> Time Shard</td><td><span data-num="60"></span>s</td><td>Instantly grant <span data-num="60"></span>s of passive income</td><td class="muted"><span data-num="5"></span>m</td></tr>
                  <tr><td>Echo Loop</td><td><span class="pill">Utility</span></td><td><span data-num="3"></span> Shards</td><td><span data-num="120"></span>s</td><td>Repeat last upgrade effect at <span data-num="50"></span>%</td><td class="muted"><span data-num="15"></span>m</td></tr>
                  <tr><td>Stasis Field</td><td><span class="pill">Defense</span></td><td><span data-num="2"></span> Shards</td><td><span data-num="90"></span>s</td><td>Reduce damage taken by <span data-num="20"></span>%</td><td class="muted"><span data-num="10"></span>m</td></tr>
                </tbody>
              </table>
            </div>
            <div class="btn-row">
              <button class="btn" type="button">Activate Warp</button>
              <button class="btn secondary" type="button">View History</button>
            </div>
          </section>

          <!-- SETTINGS -->
          <section class="page" id="page-settings">
            <div class="section-head">
              <div>
                <div class="section-title">Settings</div>
                <div class="section-sub">Number notation and theme preferences (with live preview).</div>
              </div>
              <span class="pill">System</span>
            </div>

            <div class="form-grid">
              <div class="field">
                <label>Profile Name</label>
                <input type="text" id="profileName" placeholder="Enter display name" />
              </div>

              <div class="field">
                <label>Default Section</label>
                <select id="defaultSection">
                  <option value="r-upgrades">Upgrades</option>
                  <option value="r-ore">Ore Mastery</option>
                  <option value="r-pickaxe">Pickaxe</option>
                  <option value="r-elvl">ELvl</option>
                  <option value="r-cards">Cards</option>
                  <option value="r-timewarp">Time Warp</option>
                  <option value="r-settings">Settings</option>
                </select>
                <div class="section-sub" style="margin-top:8px;">Applies on refresh (demo).</div>
              </div>

              <div class="field">
                <label>Theme</label>
                <div class="radio-row">
                  <label class="radio-pill"><input type="radio" name="theme" value="light" /><span>Light</span></label>
                  <label class="radio-pill"><input type="radio" name="theme" value="dark" /><span>Dark</span></label>
                  <label class="radio-pill"><input type="radio" name="theme" value="system" checked /><span>System</span></label>
                </div>
              </div>

              <div class="field">
                <label>Number Notation</label>
                <div class="radio-row">
                  <label class="radio-pill"><input type="radio" name="notation" value="suffix" checked /><span>K/M/B/T/Qd/Qn</span></label>
                  <label class="radio-pill"><input type="radio" name="notation" value="scientific" /><span>Scientific (e)</span></label>
                  <label class="radio-pill"><input type="radio" name="notation" value="index" /><span>Index (×10^)</span></label>
                </div>

                <div class="demo-box">
                  <div class="demo-row"><span class="demo-k">1,234</span><span class="demo-v" data-demo="1234"></span></div>
                  <div class="demo-row"><span class="demo-k">987,654,321</span><span class="demo-v" data-demo="987654321"></span></div>
                  <div class="demo-row"><span class="demo-k">1,230,000,000,000,000</span><span class="demo-v" data-demo="1230000000000000"></span></div>
                </div>
              </div>

              <div class="field">
                <label>UI Scale</label>
                <select id="uiScale">
                  <option value="compact">Compact</option>
                  <option value="comfortable" selected>Comfortable</option>
                  <option value="spacious">Spacious</option>
                </select>
              </div>

              <div class="field">
                <label>Gameplay Toggles</label>
                <div class="toggle"><input type="checkbox" id="showHints" checked /><span>Show unlock hints</span></div>
                <div class="toggle" style="margin-top:8px;"><input type="checkbox" id="hardcore" /><span>Enable hardcore mode</span></div>
              </div>
            </div>

            <div class="btn-row">
              <button class="btn" type="button" id="saveSettings">Save Settings</button>
              <button class="btn secondary" type="button" id="resetSettings">Reset Defaults</button>
            </div>
          </section>

        </div>
      </main>
    </div>

  </div>

  <script>
    const STORAGE_KEY = "remblyx_mini_settings_v1";

    const DEFAULT_PROMPTS = {
      elvl1: "",
      pickaxeChoice: "",      // stores pickaxe id
      pickaxeDropdown1: ""    // stores dropdown value
    };

    const DEFAULTS = {
      theme: "system",
      notation: "suffix",
      profileName: "",
      defaultSection: "r-upgrades",
      uiScale: "comfortable",
      showHints: true,
      hardcore: false,
      prompts: { ...DEFAULT_PROMPTS }
    };

    // Update this list to match your real filenames in images/pickaxe/
    const PICKAXE_OPTIONS = [
      { id: "normalp", name: "Normal Pickaxe", img: "images/pickaxe/normal_pickaxe.png" },
      { id: "goldp", name: "Gold Pickaxe", img: "images/pickaxe/gold_pickaxe.png" },
      { id: "diamondp", name: "Diamond Pickaxe", img: "images/pickaxe/diamond_pickaxe.png" },
      { id: "dragonstonep", name: "Dragonstone Pickaxe", img: "images/pickaxe/dragonstone_pickaxe.png" },
      { id: "starglassp", name: "Starglass Pickaxe", img: "images/pickaxe/starglass_pickaxe.png" },
    ];

    function loadSettings(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw){
          return { ...DEFAULTS, prompts: { ...DEFAULT_PROMPTS } };
        }
        const parsed = JSON.parse(raw);

        return {
          ...DEFAULTS,
          ...parsed,
          prompts: {
            ...DEFAULT_PROMPTS,
            ...(parsed.prompts || {})
          }
        };
      }catch{
        return { ...DEFAULTS, prompts: { ...DEFAULT_PROMPTS } };
      }
    }

    function saveSettingsObj(obj){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(obj));
    }

    function applyTheme(theme){
      const root = document.documentElement;
      if(theme === "system"){
        const prefersDark = window.matchMedia && window.matchMedia("(prefers-color-scheme: dark)").matches;
        root.setAttribute("data-theme", prefersDark ? "dark" : "light");
      }else{
        root.setAttribute("data-theme", theme);
      }
    }

    function bindSystemThemeListener(getTheme){
      if(!window.matchMedia) return;
      const mq = window.matchMedia("(prefers-color-scheme: dark)");
      mq.addEventListener?.("change", () => {
        if(getTheme() === "system") applyTheme("system");
      });
    }

    function tidyFixed(value, decimals){
      const n = Number(value);
      if(!Number.isFinite(n)) return "0";
      const fixed = n.toFixed(decimals);
      return String(Number(fixed));
    }

    function formatSuffix(n){
      const abs = Math.abs(n);
      const sign = n < 0 ? "-" : "";
      const units = [
        { v: 1e18, s: "Qn" },
        { v: 1e15, s: "Qd" },
        { v: 1e12, s: "T" },
        { v: 1e9,  s: "B" },
        { v: 1e6,  s: "M" },
        { v: 1e3,  s: "K" },
      ];
      for(const u of units){
        if(abs >= u.v){
          const val = abs / u.v;
          const dec = val >= 100 ? 0 : val >= 10 ? 1 : 2;
          return sign + tidyFixed(val, dec) + u.s;
        }
      }
      const dec = abs >= 100 ? 0 : abs >= 10 ? 1 : 2;
      return sign + tidyFixed(abs, dec);
    }

    function formatScientific(n){
      const abs = Math.abs(n);
      if(abs === 0) return "0";
      if(abs < 1000) return String(n);
      return Number(n).toExponential(2).replace("e+","e");
    }

    function formatIndexHTML(n){
      const abs = Math.abs(n);
      if(abs === 0) return "0";
      if(abs < 1000) return String(n);
      const exp = Math.floor(Math.log10(abs));
      const mant = n / Math.pow(10, exp);
      const am = Math.abs(mant);
      const dec = am >= 100 ? 0 : am >= 10 ? 1 : 2;
      const mantStr = tidyFixed(mant, dec);
      return `${mantStr}×10<sup>${exp}</sup>`;
    }

    function formatNumber(n, mode){
      if(mode === "scientific") return { text: formatScientific(n), html: null };
      if(mode === "index") return { text: null, html: formatIndexHTML(n) };
      return { text: formatSuffix(n), html: null };
    }

    function updateNumberDisplays(mode){
      document.querySelectorAll("[data-num]").forEach(node => {
        const n = Number(node.getAttribute("data-num"));
        const out = formatNumber(n, mode);
        if(out.html) node.innerHTML = out.html; else node.textContent = out.text ?? String(n);
      });

      document.querySelectorAll("[data-demo]").forEach(node => {
        const n = Number(node.getAttribute("data-demo"));
        const out = formatNumber(n, mode);
        if(out.html) node.innerHTML = out.html; else node.textContent = out.text ?? String(n);
      });
    }

    function setRouteById(id){
      const input = document.getElementById(id);
      if(input && input.classList.contains("route")) input.checked = true;
    }

    const state = loadSettings();

    applyTheme(state.theme);
    bindSystemThemeListener(() => state.theme);
    setRouteById(state.defaultSection);

    // SETTINGS refs
    const profileName = document.getElementById("profileName");
    const defaultSection = document.getElementById("defaultSection");
    const uiScale = document.getElementById("uiScale");
    const showHints = document.getElementById("showHints");
    const hardcore = document.getElementById("hardcore");

    if(profileName) profileName.value = state.profileName;
    if(defaultSection) defaultSection.value = state.defaultSection;
    if(uiScale) uiScale.value = state.uiScale;
    if(showHints) showHints.checked = !!state.showHints;
    if(hardcore) hardcore.checked = !!state.hardcore;

    document.querySelectorAll('input[name="theme"]').forEach(r => { r.checked = (r.value === state.theme); });
    document.querySelectorAll('input[name="notation"]').forEach(r => { r.checked = (r.value === state.notation); });

    updateNumberDisplays(state.notation);

    // THEME listeners
    document.querySelectorAll('input[name="theme"]').forEach(r => {
      r.addEventListener("change", () => {
        state.theme = r.value;
        applyTheme(state.theme);
      });
    });

    // NOTATION listeners
    document.querySelectorAll('input[name="notation"]').forEach(r => {
      r.addEventListener("change", () => {
        state.notation = r.value;
        updateNumberDisplays(state.notation);
      });
    });

    const saveBtn = document.getElementById("saveSettings");
    const resetBtn = document.getElementById("resetSettings");

    function collectStateFromUI(){
      state.profileName = profileName?.value ?? "";
      state.defaultSection = defaultSection?.value ?? "r-upgrades";
      state.uiScale = uiScale?.value ?? "comfortable";
      state.showHints = showHints?.checked ?? true;
      state.hardcore = hardcore?.checked ?? false;

      const themeSel = document.querySelector('input[name="theme"]:checked');
      const notationSel = document.querySelector('input[name="notation"]:checked');
      state.theme = themeSel?.value ?? "system";
      state.notation = notationSel?.value ?? "suffix";
    }

    if(saveBtn){
      saveBtn.addEventListener("click", () => {
        collectStateFromUI();
        saveSettingsObj(state);
        applyTheme(state.theme);
        updateNumberDisplays(state.notation);
        saveBtn.textContent = "Saved";
        window.setTimeout(() => saveBtn.textContent = "Save Settings", 700);
      });
    }

    // --- PROMPTS (ELvl + Pickaxe Flow) ---
    const elvlPrompt1 = document.getElementById("elvlPrompt1");

    // Pickaxe UI refs
    const pickaxeGrid = document.getElementById("pickaxeChooserGrid");
    const pickaxeStepChoose = document.getElementById("pickaxeStepChoose");
    const pickaxeStepDropdown = document.getElementById("pickaxeStepDropdown");
    const pickaxeSelectedName = document.getElementById("pickaxeSelectedName");
    const pickaxeDropdown1 = document.getElementById("pickaxeDropdown1");
    const pickaxeChangeBtn = document.getElementById("pickaxeChangeBtn");

    function ensurePrompts(){
      if(!state.prompts) state.prompts = { ...DEFAULT_PROMPTS };
    }

    function showPickaxeStep(step){
      // step: "choose" | "dropdown"
      if(!pickaxeStepChoose || !pickaxeStepDropdown) return;

      if(step === "dropdown"){
        pickaxeStepChoose.classList.add("hidden");
        pickaxeStepDropdown.classList.remove("hidden");
      }else{
        pickaxeStepDropdown.classList.add("hidden");
        pickaxeStepChoose.classList.remove("hidden");
      }
    }

    function syncPickaxeSelectedName(){
      if(!pickaxeSelectedName) return;
      const selectedId = state.prompts.pickaxeChoice;
      const obj = PICKAXE_OPTIONS.find(o => o.id === selectedId);
      pickaxeSelectedName.value = obj ? obj.name : "";
    }

    function setPickaxeChoice(id){
      ensurePrompts();
      state.prompts.pickaxeChoice = id;

      // Auto-go to Step 2 immediately
      saveSettingsObj(state);
      renderPickaxeChooser(id);
      syncPickaxeSelectedName();
      showPickaxeStep("dropdown");
    }

    function renderPickaxeChooser(selectedId){
      if(!pickaxeGrid) return;

      pickaxeGrid.innerHTML = "";

      PICKAXE_OPTIONS.forEach(opt => {
        const card = document.createElement("div");
        card.className = "pickaxe-card" + (opt.id === selectedId ? " selected" : "");
        card.setAttribute("role", "option");
        card.setAttribute("aria-selected", opt.id === selectedId ? "true" : "false");
        card.tabIndex = 0;
        card.dataset.pickaxeId = opt.id;

        card.innerHTML = `
          <span class="pickaxe-badge">Selected</span>
          <img class="pickaxe-img" src="${opt.img}" alt="${opt.name}" loading="lazy"
               onerror="this.style.opacity=0.35; this.alt='Missing image';" />
          <div class="pickaxe-name">${opt.name}</div>
          <div class="pickaxe-sub">${opt.sub ?? ""}</div>
        `;

        const activate = () => setPickaxeChoice(opt.id);

        card.addEventListener("click", activate);
        card.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " "){
            e.preventDefault();
            activate();
          }
        });

        pickaxeGrid.appendChild(card);
      });
    }

    function loadPromptsToUI(){
      ensurePrompts();
      const p = state.prompts;

      if(elvlPrompt1) elvlPrompt1.value = p.elvl1 ?? "";

      // Pickaxe
      renderPickaxeChooser(p.pickaxeChoice ?? "");
      if(pickaxeDropdown1) pickaxeDropdown1.value = p.pickaxeDropdown1 ?? "";

      syncPickaxeSelectedName();

      // Decide which step to show on load
      if(p.pickaxeChoice){
        showPickaxeStep("dropdown");
      }else{
        showPickaxeStep("choose");
      }
    }

    function collectPromptsFromUI(){
      ensurePrompts();
      state.prompts.elvl1 = elvlPrompt1?.value ?? "";
      state.prompts.pickaxeDropdown1 = pickaxeDropdown1?.value ?? "";
    }

    function wirePromptAutosave(){
      const inputs = [ elvlPrompt1, pickaxeDropdown1 ].filter(Boolean);

      const handler = () => {
        collectPromptsFromUI();
        saveSettingsObj(state);
        syncPickaxeSelectedName();
      };

      inputs.forEach(el => {
        el.addEventListener("input", handler);
        el.addEventListener("change", handler);
      });
    }

    if(pickaxeChangeBtn){
      pickaxeChangeBtn.addEventListener("click", () => {
        ensurePrompts();
        // Keep dropdown value if you want, but allow changing pickaxe
        showPickaxeStep("choose");
      });
    }

    loadPromptsToUI();
    wirePromptAutosave();

    if(resetBtn){
      resetBtn.addEventListener("click", () => {
        state.theme = DEFAULTS.theme;
        state.notation = DEFAULTS.notation;
        state.profileName = DEFAULTS.profileName;
        state.defaultSection = DEFAULTS.defaultSection;
        state.uiScale = DEFAULTS.uiScale;
        state.showHints = DEFAULTS.showHints;
        state.hardcore = DEFAULTS.hardcore;
        state.prompts = { ...DEFAULT_PROMPTS };

        saveSettingsObj(state);
        applyTheme(state.theme);
        setRouteById(state.defaultSection);

        if(profileName) profileName.value = "";
        if(defaultSection) defaultSection.value = DEFAULTS.defaultSection;
        if(uiScale) uiScale.value = DEFAULTS.uiScale;
        if(showHints) showHints.checked = DEFAULTS.showHints;
        if(hardcore) hardcore.checked = DEFAULTS.hardcore;

        document.querySelectorAll('input[name="theme"]').forEach(r => { r.checked = (r.value === DEFAULTS.theme); });
        document.querySelectorAll('input[name="notation"]').forEach(r => { r.checked = (r.value === DEFAULTS.notation); });

        updateNumberDisplays(state.notation);
        loadPromptsToUI();

        resetBtn.textContent = "Reset";
        window.setTimeout(() => resetBtn.textContent = "Reset Defaults", 700);
      });
    }
  </script>
</body>
</html>
